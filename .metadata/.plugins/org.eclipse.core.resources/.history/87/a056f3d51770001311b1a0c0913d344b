package regularExpressionMatching;

import java.util.Stack;
// 这个方法是用正常前进，但是如果不匹配还是要倒退回来，因为不像另外一个情况，这个* 不能匹配任意，要根据p 不同的情况来进行不同的匹配。所以要将这个存起来。
// 因为要区别带有*号什么时候忽略什么时候要进行比较， 所以用了一个flag 当不行了之后要返回，就将flag 置true 一旦返回了一次之后就把flag 置回false。
public class UseStack {
	public  boolean isMatch(String s, String p) {
		int indexS = 0;
		int indexP = 0;
		Stack<starIndex> stack = new Stack<starIndex>();
		boolean isBack = false;
		if (s == null || p == null) {
			return false;
		}
		if (s.isEmpty() && p.isEmpty()) {
			return true;
		} else if (p.isEmpty() && !s.isEmpty()) {
			return false;
		}

		int countStar = 0;
		for (int i = 0; i < p.length(); i++) {
			if (p.charAt(i) == '*') {
				countStar++;
			}
		}

		if (p.length() - countStar * 2 > s.length()) {
			return false;
		}
		
		while (indexS < s.length()) {
			if (indexP == p.length()) {
				if (!stack.isEmpty()) {
					starIndex node = stack.pop();
					indexP = node.indexP;
					indexS = node.indexS;
					isBack = true;
					continue;
				} else {
					return false;
				}
			}
			
			char cs = s.charAt(indexS);
			char cp = p.charAt(indexP);
			
			if (isBack) {
				if (cp == '.' || cs == cp) {
					indexS++;
					isBack = false;
					continue;
				} else if (!stack.isEmpty()){
					starIndex node = stack.pop();
					indexP = node.indexP;
					indexS = node.indexS;
					isBack = true;
					continue;
					
				} else {
					return false;
				}
			}
			
			if (indexP + 1 < p.length() && p.charAt(indexP + 1) == '*' ) {
				stack.push(new starIndex(indexS, indexP));
				indexP += 2;
			} else if (cp == '.' || cs == cp) {
				indexP++;
				indexS++;
			} else if (cs != cp && cp != '.' && !stack.isEmpty()) {
				starIndex node = stack.pop();
				indexP = node.indexP;
				indexS = node.indexS;
				isBack = true;
			} else {
				return false;
			}
		}
		
		while (indexP < p.length()) {
			if (indexP + 1 >= p.length()) {
				return false;
			} else if(p.charAt(indexP + 1) != '*') {
				return false;
			}
			indexP += 2;
		}
		
		return true;

	}
	
	public class starIndex {
		int indexS;
		int indexP;
		public starIndex(int s, int p) {
			indexS = s;
			indexP = p;
		}
		public String toString() {
			return "S: " + indexS + " P: " + indexP;
		}
	}
	
	public static void main(String[] args) {
		UseStack useStack = new UseStack();
		System.out.println(useStack.isMatch("aaa", "ab*a*c*a") == true);
		System.out.println(useStack.isMatch("aa", "a") == false);
		System.out.println(useStack.isMatch("aa", "aa") == true);
		System.out.println(useStack.isMatch("aaa", "aa") == false);
		System.out.println(useStack.isMatch("aa", "a*") == true);
		System.out.println(useStack.isMatch("aa", ".*") == true);
		System.out.println(useStack.isMatch("ab", ".*") == true);
		System.out.println(useStack.isMatch("aab", "c*a*b") == true);
	}

}
